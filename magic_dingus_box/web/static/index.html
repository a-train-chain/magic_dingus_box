<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Dingus Box - Content Manager</title>
    <link rel="stylesheet" href="/static/style.css?v=7">
</head>

<body>
    <div class="container">
        <header>
            <h1>Magic Dingus Box</h1>
            <p class="subtitle">Content Manager</p>
        </header>

        <!-- Collapsible Device Selector -->
        <section class="collapsible-section device-selector-wrapper">
            <div class="section-header" onclick="toggleSection('deviceSelector')">
                <h2>
                    <span class="collapse-icon" id="deviceSelectorIcon">‚ñº</span>
                    Device Connection
                    <span class="section-status" id="deviceConnectionStatus">Not Connected</span>
                </h2>
            </div>
            <div class="section-content" id="deviceSelector">
                <div id="deviceStatus" class="device-status">
                    <span class="icon">üîç</span>
                    <span id="statusText">Searching for devices...</span>
                </div>
                <div id="deviceList" class="device-list"></div>
                <button id="manualConnect" class="btn-secondary">Connect to IP Address</button>
            </div>
        </section>

        <!-- Device Settings & Backup Section -->
        <section class="collapsible-section settings-section" id="settingsSectionWrapper" style="display: none;">
            <div class="section-header" onclick="toggleSection('settingsContent')">
                <h2>
                    <span class="collapse-icon" id="settingsContentIcon">‚ñ∂</span>
                    Settings & Backup
                </h2>
            </div>
            <div class="section-content collapsed" id="settingsContent">
                <div class="settings-grid">
                    <!-- Backup Section -->
                    <div class="settings-card">
                        <h4>Backup</h4>
                        <p class="settings-description">Download a backup of all playlists, settings, and device configuration.</p>
                        <button id="downloadBackup" class="btn-primary" onclick="downloadBackup()">Download Backup</button>
                    </div>

                    <!-- Restore Section -->
                    <div class="settings-card">
                        <h4>Restore</h4>
                        <p class="settings-description">Restore from a previously downloaded backup file.</p>
                        <div class="restore-upload">
                            <input type="file" id="restoreFile" accept=".zip" style="display: none;" onchange="handleRestoreUpload(this)">
                            <button id="restoreButton" class="btn-secondary" onclick="document.getElementById('restoreFile').click()">Select Backup File</button>
                        </div>
                        <div id="restoreStatus" class="restore-status"></div>
                    </div>

                    <!-- System Health Section -->
                    <div class="settings-card">
                        <h4>System Health</h4>
                        <div id="healthInfo" class="health-info">
                            <span class="loading">Loading...</span>
                        </div>
                        <button class="btn-secondary small" onclick="refreshHealthInfo()">Refresh</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab Navigation -->
        <nav class="tabs">
            <button class="tab active" data-tab="videos">üìπ Videos & Playlists</button>
            <button class="tab" data-tab="roms">üéÆ ROMs & Games</button>
        </nav>

        <!-- Videos Tab -->
        <section id="videos" class="tab-content active">
            <!-- Sub Navigation -->
            <nav class="sub-tabs">
                <button class="sub-tab active" onclick="switchVideoView('playlists')">My Playlists</button>
                <button class="sub-tab" onclick="switchVideoView('editor')">Playlist Editor</button>
                <button class="sub-tab" onclick="switchVideoView('library')">All Videos</button>
            </nav>

            <!-- View: My Playlists -->
            <div id="videoPlaylistsView" class="sub-view active">
                <div class="view-header">
                    <h3>My Video Playlists <span class="count-badge" id="videoPlaylistCount">0</span></h3>
                    <button class="btn-primary small" onclick="createNewVideoPlaylist()">+ New Playlist</button>
                </div>
                <div id="videoPlaylistsList" class="grid-list"></div>
            </div>

            <!-- View: Playlist Editor -->
            <div id="videoEditorView" class="sub-view" style="display: none;">
                <div class="editor-layout">
                    <!-- Left Column: Playlist Details & Items -->
                    <div class="editor-main">
                        <div class="view-header">
                            <h3 id="editorTitle">New Playlist</h3>
                            <div class="editor-actions">
                                <button type="button" class="btn-secondary small"
                                    id="cancelVideoPlaylistEdit">Cancel</button>
                                <button type="button" class="btn-primary small" id="saveVideoPlaylist">Save
                                    Playlist</button>
                            </div>
                        </div>

                        <form id="videoPlaylistForm" class="form compact-form" autocomplete="off" novalidate>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Title</label>
                                    <input type="text" id="videoPlaylistTitle" placeholder="Playlist Title">
                                </div>
                                <div class="form-group">
                                    <label>Curator</label>
                                    <input type="text" id="videoPlaylistCurator" placeholder="Curator Name">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <input type="text" id="videoPlaylistDesc" placeholder="Description">
                            </div>
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="videoPlaylistLoop"> Loop playlist
                                </label>
                            </div>
                        </form>

                        <div class="playlist-panel">
                            <h4>Playlist Items <span id="playlistItemCount" class="count-badge">0</span></h4>
                            <div id="videoPlaylistItems" class="playlist-items-list"></div>
                            <div class="empty-state" id="videoPlaylistEmpty">
                                Drag videos here from the right panel<br>or upload new videos directly
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Sources -->
                    <div class="editor-sidebar">
                        <div class="sidebar-tabs">
                            <button class="sidebar-tab active" onclick="switchSourceTab('library')">From
                                Library</button>
                            <button class="sidebar-tab" onclick="switchSourceTab('upload')">Upload New</button>
                        </div>

                        <!-- Source: Library -->
                        <div id="sourceLibrary" class="source-content active">
                            <div class="search-bar">
                                <input type="text" id="videoSearch" placeholder="Search videos..."
                                    onkeyup="filterVideoLibrary()">
                            </div>
                            <div id="videoPlaylistAvailable" class="content-pool"></div>
                        </div>

                        <!-- Source: Upload -->
                        <div id="sourceUpload" class="source-content" style="display: none;">
                            <div class="upload-zone">
                                <input type="file" id="videoUpload" accept="video/*" multiple
                                    onchange="handleDirectUpload(this)">
                                <label for="videoUpload" class="upload-label">
                                    <span class="icon">‚òÅÔ∏è</span>
                                    <span class="text">Click to Upload<br><small>Auto-adds to playlist</small></span>
                                </label>
                            </div>
                            <div id="uploadProgress"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- View: Library (All Videos) -->
            <div id="videoLibraryView" class="sub-view" style="display: none;">
                <div class="view-header">
                    <h3>All Videos <span class="count-badge" id="videoCount">0</span></h3>
                    <div class="search-bar">
                        <input type="text" placeholder="Search all videos..." onkeyup="filterMainLibrary(this)">
                    </div>
                </div>
                <div id="videoList"></div>
            </div>
        </section>

        <!-- ROMs Tab -->
        <section id="roms" class="tab-content">
            <!-- Sub Navigation -->
            <nav class="sub-tabs">
                <button class="sub-tab active" onclick="switchGameView('playlists')">My Playlists</button>
                <button class="sub-tab" onclick="switchGameView('editor')">Playlist Editor</button>
                <button class="sub-tab" onclick="switchGameView('library')">ROM Library</button>
            </nav>

            <!-- View: My Playlists -->
            <div id="gamePlaylistsView" class="sub-view active">
                <div class="view-header">
                    <h3>My Game Playlists <span class="count-badge" id="gamePlaylistCount">0</span></h3>
                    <button class="btn-primary small" onclick="createNewGamePlaylist()">+ New Playlist</button>
                </div>
                <div id="gamePlaylistsList" class="grid-list"></div>
            </div>

            <!-- View: Playlist Editor -->
            <div id="gameEditorView" class="sub-view" style="display: none;">
                <div class="editor-layout">
                    <!-- Left Column: Playlist Details & Items -->
                    <div class="editor-main">
                        <div class="view-header">
                            <h3 id="gameEditorTitle">New Playlist</h3>
                            <div class="editor-actions">
                                <button type="button" class="btn-secondary small"
                                    id="cancelGamePlaylistEdit">Cancel</button>
                                <button type="button" class="btn-primary small" id="saveGamePlaylist">Save
                                    Playlist</button>
                            </div>
                        </div>

                        <form id="gamePlaylistForm" class="form compact-form" autocomplete="off" novalidate>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Title</label>
                                    <input type="text" id="gamePlaylistTitle" placeholder="Playlist Title">
                                </div>
                                <div class="form-group">
                                    <label>Curator</label>
                                    <input type="text" id="gamePlaylistCurator" placeholder="Curator Name">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <input type="text" id="gamePlaylistDesc" placeholder="Description">
                            </div>
                            <div class="form-group checkbox-group">
                                <label>
                                    <input type="checkbox" id="gamePlaylistLoop"> Loop playlist
                                </label>
                            </div>
                        </form>

                        <div class="playlist-panel">
                            <h4>Playlist Items <span id="gamePlaylistItemCount" class="count-badge">0</span></h4>
                            <div id="gamePlaylistItems" class="playlist-items-list"></div>
                            <div class="empty-state" id="gamePlaylistEmpty">
                                Drag games here from the right panel<br>or upload new ROMs directly
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Sources -->
                    <div class="editor-sidebar">
                        <div class="sidebar-tabs">
                            <button class="sidebar-tab active" onclick="switchGameSourceTab('library')">From
                                Library</button>
                            <button class="sidebar-tab" onclick="switchGameSourceTab('upload')">Upload New</button>
                        </div>

                        <!-- Source: Library -->
                        <div id="sourceGameLibrary" class="source-content active">
                            <div class="search-bar">
                                <input type="text" id="gameSearch" placeholder="Search ROMs..."
                                    onkeyup="filterGameLibrary()">
                            </div>
                            <div id="gamePlaylistAvailable" class="content-pool"></div>
                        </div>

                        <!-- Source: Upload -->
                        <div id="sourceGameUpload" class="source-content" style="display: none;">
                            <div class="upload-zone-container">
                                <div class="system-selector" style="margin-bottom: 1rem;">
                                    <label for="systemSelect">System:</label>
                                    <select id="systemSelect" style="width: 100%; padding: 0.5rem;">
                                        <option value="nes">NES</option>
                                        <option value="snes">SNES</option>
                                        <option value="genesis">Sega Genesis</option>
                                        <option value="ps1">PlayStation</option>
                                        <option value="atari7800">Atari 7800</option>
                                        <option value="pcengine">PC Engine</option>
                                        <option value="arcade">Arcade</option>
                                    </select>
                                </div>
                                <div class="upload-zone">
                                    <input type="file" id="romUpload" multiple onchange="handleDirectROMUpload(this)">
                                    <label for="romUpload" class="upload-label">
                                        <span class="icon">üéÆ</span>
                                        <span class="text">Click to Upload<br><small>Auto-adds to
                                                playlist</small></span>
                                    </label>
                                </div>
                            </div>
                            <div id="romUploadProgress"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- View: Library (All ROMs) -->
            <div id="romLibraryView" class="sub-view" style="display: none;">
                <div class="view-header">
                    <h3>ROM Library <span class="count-badge" id="romCount">0</span></h3>
                </div>
                <div id="romsList" class="accordion"></div>
            </div>
        </section>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">Confirm Action</h3>
            <p id="modalMessage">Are you sure?</p>
            <div class="modal-actions">
                <button id="modalCancel" type="button" class="btn-secondary">Cancel</button>
                <button id="modalConfirm" type="button" class="btn-primary">Confirm</button>
            </div>
        </div>
    </div>

    <script src="/static/manager.js?v=17"></script>
</body>

</html>