<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Dingus Box - Content Manager</title>
    <link rel="stylesheet" href="/static/style.css?v=31">
</head>

<body>
    <div class="container">
        <header>
            <img src="/static/images/logo.png" alt="Magic Dingus Box" class="header-logo">
            <p class="subtitle">Content Manager</p>
            <div id="connectionBadge" class="connection-badge disconnected">
                <span class="badge-icon">‚ö°</span>
                <span id="connectionBadgeText">Not Connected</span>
            </div>
        </header>

        <!-- Collapsible Device Selector -->
        <section class="collapsible-section device-selector-wrapper">
            <div class="section-header" onclick="toggleSection('deviceSelector')">
                <h2>
                    <span class="collapse-icon" id="deviceSelectorIcon">‚ñº</span>
                    Device Connection
                    <span class="section-status" id="deviceConnectionStatus">Not Connected</span>
                </h2>
            </div>
            <div class="section-content" id="deviceSelector">
                <div id="deviceStatus" class="device-status">
                    <span class="icon">üîç</span>
                    <span id="statusText">Searching for devices...</span>
                </div>
                <div id="deviceList" class="device-list"></div>
                <button id="manualConnect" class="btn-secondary">Connect to IP Address</button>
            </div>
        </section>

        <!-- Device Settings & Backup Section -->
        <section class="collapsible-section settings-section" id="settingsSectionWrapper" style="display: none;">
            <div class="section-header" onclick="toggleSection('settingsContent')">
                <h2>
                    <span class="collapse-icon" id="settingsContentIcon">‚ñ∂</span>
                    Settings & Backup
                </h2>
            </div>
            <div class="section-content collapsed" id="settingsContent">
                <div class="settings-grid">
                    <!-- Backup Section -->
                    <div class="settings-card">
                        <h4>Backup</h4>
                        <p class="settings-description">Download a backup of all playlists, settings, and device
                            configuration.</p>
                        <button id="downloadBackup" class="btn-primary" onclick="downloadBackup()">Download
                            Backup</button>
                    </div>

                    <!-- Restore Section -->
                    <div class="settings-card">
                        <h4>Restore</h4>
                        <p class="settings-description">Restore from a previously downloaded backup file.</p>
                        <div class="restore-upload">
                            <input type="file" id="restoreFile" accept=".zip" style="display: none;"
                                onchange="handleRestoreUpload(this)">
                            <button id="restoreButton" class="btn-secondary"
                                onclick="document.getElementById('restoreFile').click()">Select Backup File</button>
                        </div>
                        <div id="restoreStatus" class="restore-status"></div>
                    </div>

                    <!-- System Health Section -->
                    <div class="settings-card">
                        <h4>System Health</h4>
                        <div id="healthInfo" class="health-info">
                            <span class="loading">Loading...</span>
                        </div>
                        <button class="btn-secondary small" onclick="refreshHealthInfo()">Refresh</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab Navigation -->
        <nav class="tabs" id="topTabs">
            <button class="tab active" data-tab="videos">üìπ Videos & Playlists</button>
            <button class="tab" data-tab="roms">üéÆ ROMs & Games</button>
            <button class="tab" data-tab="settings">‚öôÔ∏è Settings</button>
        </nav>

        <!-- Videos Tab -->
        <section id="videos" class="tab-content active">
            <!-- Sub Navigation -->
            <nav class="sub-tabs">
                <button class="sub-tab active" onclick="switchVideoView('playlists')">My Playlists</button>
                <button class="sub-tab" onclick="switchVideoView('editor')">Playlist Editor</button>
                <button class="sub-tab" onclick="switchVideoView('library')">All Videos</button>
            </nav>

            <!-- View: My Playlists -->
            <div id="videoPlaylistsView" class="sub-view active">
                <div class="view-header">
                    <h3>My Video Playlists <span class="count-badge" id="videoPlaylistCount">0</span></h3>
                    <button class="btn-primary small" onclick="createNewVideoPlaylist()">+ New Playlist</button>
                </div>
                <div id="videoPlaylistsList" class="grid-list"></div>
            </div>

            <!-- View: Playlist Editor -->
            <div id="videoEditorView" class="sub-view" style="display: none;">
                <div class="playlist-editor-container">
                    <!-- Left: Playlist Panel (Focal Point) -->
                    <div class="playlist-panel-main">
                        <div class="playlist-header">
                            <div class="playlist-title-section">
                                <input type="text" id="videoPlaylistTitle" class="playlist-title-input"
                                    placeholder="Playlist Title">
                                <input type="text" id="videoPlaylistCurator" class="playlist-curator-input"
                                    placeholder="Curator">
                            </div>
                            <div class="playlist-actions">
                                <button type="button" class="btn-secondary small"
                                    id="cancelVideoPlaylistEdit">Cancel</button>
                                <button type="button" class="btn-primary small" id="saveVideoPlaylist">Save</button>
                            </div>
                        </div>

                        <div class="playlist-options-row">
                            <input type="text" id="videoPlaylistDesc" class="playlist-desc-input"
                                placeholder="Description (optional)">
                            <label class="playlist-loop-label">
                                <input type="checkbox" id="videoPlaylistLoop"> Loop
                            </label>
                        </div>

                        <div class="playlist-table-container">
                            <table class="playlist-table" id="playlistTable">
                                <thead>
                                    <tr>
                                        <th class="col-num">#</th>
                                        <th class="col-title">Title</th>
                                        <th class="col-artist">Artist</th>
                                        <th class="col-actions">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="playlistTableBody">
                                    <!-- Playlist items rendered here -->
                                </tbody>
                            </table>
                            <div class="playlist-empty-state" id="playlistEmptyState">
                                <p>Drag videos here from the library</p>
                                <p class="hint">or click "Add Empty Slot" below</p>
                            </div>
                        </div>

                        <div class="playlist-footer">
                            <button type="button" class="btn-add-slot" id="addEmptySlot">+ Add Empty Slot</button>
                            <span class="playlist-count" id="playlistItemCount">0 items</span>
                        </div>
                    </div>

                    <!-- Right: Library Panel -->
                    <div class="library-panel">
                        <div class="library-header">
                            <h4>üìÅ Video Library</h4>
                            <span class="library-count" id="libraryCount">0</span>
                        </div>

                        <div class="library-filters">
                            <input type="text" id="librarySearch" class="library-search"
                                placeholder="üîç Search videos...">
                            <label class="library-filter-checkbox">
                                <input type="checkbox" id="hideUsedVideos"> Hide videos in playlists
                            </label>
                        </div>

                        <div class="library-list" id="libraryList">
                            <!-- Library items rendered here -->
                        </div>

                        <div class="library-upload-section">
                            <div class="upload-header" onclick="toggleLibraryUpload()">
                                <span>‚¨ÜÔ∏è Upload New Videos</span>
                                <span class="toggle-icon" id="uploadToggleIcon">‚ñº</span>
                            </div>
                            <div class="upload-content" id="libraryUploadContent" style="display: none;">
                                <div class="resolution-row">
                                    <label>Format:</label>
                                    <select id="targetResolution" class="resolution-select-compact">
                                        <option value="crt" selected>üì∫ CRT 640√ó480</option>
                                        <option value="modern">üñ•Ô∏è Modern 1280√ó720</option>
                                    </select>
                                </div>
                                <div class="upload-zone-compact">
                                    <input type="file" id="videoUpload" accept="video/*" multiple
                                        onchange="handleDirectUpload(this)">
                                    <label for="videoUpload" class="upload-label-compact">
                                        Click to Upload Videos
                                    </label>
                                </div>
                                <!-- Transcoding Status -->
                                <div id="transcodeStatus" class="transcode-status" style="display: none;">
                                    <div class="transcode-header">
                                        <span class="transcode-icon">‚öôÔ∏è</span>
                                        <span class="transcode-label">Processing...</span>
                                    </div>
                                    <div class="transcode-progress-bar">
                                        <div class="transcode-progress-fill" style="width: 0%"></div>
                                    </div>
                                    <div class="transcode-details"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- View: Library (All Videos) -->
            <div id="videoLibraryView" class="sub-view" style="display: none;">
                <div class="view-header">
                    <h3>All Videos <span class="count-badge" id="videoCount">0</span></h3>
                    <div class="search-bar">
                        <input type="text" placeholder="Search all videos..." onkeyup="filterMainLibrary(this)">
                    </div>
                </div>
                <div id="videoList"></div>
            </div>
        </section>

        <!-- ROMs Tab -->
        <section id="roms" class="tab-content">
            <!-- Sub Navigation -->
            <nav class="sub-tabs">
                <button class="sub-tab active" onclick="switchGameView('playlists')">My Playlists</button>
                <button class="sub-tab" onclick="switchGameView('editor')">Playlist Editor</button>
                <button class="sub-tab" onclick="switchGameView('library')">ROM Library</button>
            </nav>

            <!-- View: My Playlists -->
            <div id="gamePlaylistsView" class="sub-view active">
                <div class="view-header">
                    <h3>My Game Playlists <span class="count-badge" id="gamePlaylistCount">0</span></h3>
                    <button class="btn-primary small" onclick="createNewGamePlaylist()">+ New Playlist</button>
                </div>
                <div id="gamePlaylistsList" class="grid-list"></div>
            </div>

            <!-- View: Playlist Editor -->
            <div id="gameEditorView" class="sub-view" style="display: none;">
                <div class="playlist-editor-container">
                    <!-- Left: Playlist Panel (Focal Point) -->
                    <div class="playlist-panel-main">
                        <div class="playlist-header">
                            <div class="playlist-title-section">
                                <input type="text" id="gamePlaylistTitle" class="playlist-title-input"
                                    placeholder="Playlist Title">
                                <input type="text" id="gamePlaylistCurator" class="playlist-curator-input"
                                    placeholder="Curator">
                            </div>
                            <div class="playlist-actions">
                                <button type="button" class="btn-secondary small"
                                    id="cancelGamePlaylistEdit">Cancel</button>
                                <button type="button" class="btn-primary small" id="saveGamePlaylist">Save</button>
                            </div>
                        </div>

                        <div class="playlist-options-row">
                            <input type="text" id="gamePlaylistDesc" class="playlist-desc-input"
                                placeholder="Description (optional)">
                            <label class="playlist-loop-label">
                                <input type="checkbox" id="gamePlaylistLoop"> Loop
                            </label>
                        </div>

                        <div class="playlist-table-container">
                            <table class="playlist-table" id="gamePlaylistTable">
                                <thead>
                                    <tr>
                                        <th class="col-num">#</th>
                                        <th class="col-title">Title</th>
                                        <th class="col-artist">System</th>
                                        <th class="col-actions">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="gamePlaylistTableBody">
                                    <!-- Playlist items rendered here -->
                                </tbody>
                            </table>
                            <div class="playlist-empty-state" id="gamePlaylistEmptyState">
                                <p>Drag games here from the library</p>
                                <p class="hint">or click "Add Empty Slot" below</p>
                            </div>
                        </div>

                        <div class="playlist-footer">
                            <button type="button" class="btn-add-slot" id="addGameEmptySlot">+ Add Empty Slot</button>
                            <span class="playlist-count" id="gamePlaylistItemCount">0 items</span>
                        </div>
                    </div>

                    <!-- Right: ROM Library Panel -->
                    <div class="library-panel">
                        <div class="library-header">
                            <h4>üéÆ ROM Library</h4>
                            <span class="library-count" id="romLibraryCount">0</span>
                        </div>

                        <div class="library-filters">
                            <input type="text" id="romLibrarySearch" class="library-search"
                                placeholder="üîç Search ROMs...">
                            <label class="library-filter-checkbox">
                                <input type="checkbox" id="hideUsedROMs"> Hide ROMs in playlists
                            </label>
                        </div>

                        <div class="library-list" id="romLibraryList">
                            <!-- ROM library items rendered here -->
                        </div>

                        <div class="library-upload-section">
                            <div class="upload-header" onclick="toggleROMLibraryUpload()">
                                <span>‚¨ÜÔ∏è Upload New ROMs</span>
                                <span class="toggle-icon" id="romUploadToggleIcon">‚ñº</span>
                            </div>
                            <div class="upload-content" id="romLibraryUploadContent" style="display: none;">
                                <div class="resolution-row">
                                    <label>System:</label>
                                    <select id="systemSelect" class="resolution-select-compact">
                                        <option value="nes">NES</option>
                                        <option value="snes">SNES</option>
                                        <option value="genesis">Sega Genesis</option>
                                        <option value="ps1">PlayStation 1</option>
                                        <option value="atari7800">Atari 7800</option>
                                        <option value="pcengine">PC Engine</option>
                                        <option value="arcade">Arcade</option>
                                    </select>
                                </div>
                                <div class="upload-zone-compact">
                                    <input type="file" id="romUpload" multiple onchange="handleDirectROMUpload(this)">
                                    <label for="romUpload" class="upload-label-compact">
                                        Click to Upload ROMs
                                    </label>
                                </div>
                                <div id="romUploadProgress"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- View: Library (All ROMs) -->
            <div id="romLibraryView" class="sub-view" style="display: none;">
                <div class="view-header">
                    <h3>ROM Library <span class="count-badge" id="romCount">0</span></h3>
                </div>
                <div id="romsList" class="accordion"></div>
            </div>
        </section>

        <!-- Settings Tab -->
        <section id="settings" class="tab-content">
            <div class="settings-section-mobile">
                <div class="section-title">üì° Device Connection</div>
                <div class="section-body">
                    <div id="mobileDeviceStatus" class="device-status">
                        <span class="icon">üîç</span>
                        <span id="mobileStatusText">Checking connection...</span>
                    </div>
                    <div id="mobileDeviceList" class="device-list"></div>
                    <button id="mobileManualConnect" class="btn-secondary">Connect to IP Address</button>
                </div>
            </div>

            <div class="settings-section-mobile">
                <div class="section-title">üíæ Backup & Restore</div>
                <div class="section-body">
                    <p class="settings-description">Download a backup of all playlists
                        and settings.</p>
                    <button class="btn-primary" onclick="downloadBackup()">Download Backup</button>
                    <div style="margin-top: 1rem;">
                        <p class="settings-description">Restore from a backup file.</p>
                        <input type="file" id="mobileRestoreFile" accept=".zip" style="display: none;"
                            onchange="handleRestoreUpload(this)">
                        <button class="btn-secondary"
                            onclick="document.getElementById('mobileRestoreFile').click()">Select Backup File</button>
                    </div>
                </div>
            </div>

            <div class="settings-section-mobile">
                <div class="section-title">üíª System Health</div>
                <div class="section-body">
                    <div id="mobileHealthInfo" class="health-info">
                        <span class="loading">Loading...</span>
                    </div>
                    <button class="btn-secondary small" onclick="refreshHealthInfo()">Refresh</button>
                </div>
            </div>

            <div class="settings-section-mobile">
                <div class="section-title">üîÑ Software Updates</div>
                <div class="section-body">
                    <div id="updateInfo" class="update-info">
                        <div class="health-row">
                            <span class="health-label">Current Version</span>
                            <span class="health-value" id="currentVersion">Loading...</span>
                        </div>
                    </div>

                    <div id="updateStatus" class="update-status" style="display: none;">
                        <div class="update-header">
                            <span class="update-icon">üîÑ</span>
                            <span class="update-label">Checking...</span>
                        </div>
                        <div class="update-progress-bar">
                            <div class="update-progress-fill" style="width: 0%"></div>
                        </div>
                        <div class="update-details"></div>
                    </div>

                    <div id="updateAvailable" class="update-available" style="display: none;">
                        <div class="update-badge">Update Available!</div>
                        <div class="update-version">
                            <span id="newVersionLabel">v0.0.0</span>
                        </div>
                        <div class="update-notes" id="releaseNotes"></div>
                    </div>

                    <div class="update-actions">
                        <button class="btn-primary" id="checkUpdateBtn" onclick="checkForUpdates()">
                            Check for Updates
                        </button>
                        <button class="btn-secondary" id="installUpdateBtn" onclick="installUpdate()"
                                style="display: none;">
                            Install Update
                        </button>
                        <button class="btn-secondary" id="rollbackBtn" onclick="rollbackUpdate()"
                                style="display: none;">
                            Rollback
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Bottom Navigation for Mobile -->
    <nav class="bottom-nav" id="bottomNav">
        <button class="bottom-nav-item active" data-tab="videos">
            <span class="nav-icon">üìπ</span>
            <span>Videos</span>
        </button>
        <button class="bottom-nav-item" data-tab="roms">
            <span class="nav-icon">üéÆ</span>
            <span>Games</span>
        </button>
        <button class="bottom-nav-item" data-tab="settings">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span>Settings</span>
        </button>
    </nav>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">Confirm Action</h3>
            <p id="modalMessage">Are you sure?</p>
            <div class="modal-actions">
                <button id="modalCancel" type="button" class="btn-secondary">Cancel</button>
                <button id="modalConfirm" type="button" class="btn-primary">Confirm</button>
            </div>
        </div>
    </div>

    <script src="/static/manager.js?v=44"></script>

</body>

</html>